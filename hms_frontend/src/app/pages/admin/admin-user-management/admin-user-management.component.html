<div class="user-management">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Quáº£n lÃ½ tÃ i khoáº£n</h1>
      <p class="subtitle">Quáº£n lÃ½ ngÆ°á»i dÃ¹ng vÃ  phÃ¢n quyá»n há»‡ thá»‘ng</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="exportToCSV()">
        <span>ğŸ“¥</span> Xuáº¥t Excel
      </button>
      <button class="btn-primary" routerLink="/admin/users/new">
        <span>â•</span> ThÃªm tÃ i khoáº£n
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-overview">
    <div class="stat-item">
      <div class="stat-icon total">ğŸ‘¥</div>
      <div class="stat-info">
        <span class="stat-label">Tá»•ng</span>
        <span class="stat-value">{{ totalUsers }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon active">âœ…</div>
      <div class="stat-info">
        <span class="stat-label">Hoáº¡t Ä‘á»™ng</span>
        <span class="stat-value">{{ activeUsers }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon locked">ğŸ”’</div>
      <div class="stat-info">
        <span class="stat-label">Bá»‹ khÃ³a</span>
        <span class="stat-value">{{ lockedUsers }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon admin">ğŸ›¡ï¸</div>
      <div class="stat-info">
        <span class="stat-label">Admin</span>
        <span class="stat-value">{{ adminCount }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon manager">ğŸ‘”</div>
      <div class="stat-info">
        <span class="stat-label">Quáº£n lÃ½</span>
        <span class="stat-value">{{ managerCount }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon staff">ğŸ‘¨â€ğŸ’¼</div>
      <div class="stat-info">
        <span class="stat-label">NhÃ¢n viÃªn</span>
        <span class="stat-value">{{ staffCount }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon user">ğŸ‘¤</div>
      <div class="stat-info">
        <span class="stat-label">KhÃ¡ch</span>
        <span class="stat-value">{{ userCount }}</span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Äang táº£i danh sÃ¡ch ngÆ°á»i dÃ¹ng...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="alert-error">
    <span>âš ï¸ {{ error }}</span>
    <button class="btn-retry" (click)="loadUsers()">Thá»­ láº¡i</button>
  </div>

  <!-- User List -->
  <div *ngIf="!loading && !error" class="user-list-container">
    <!-- Filters -->
    <div class="filters-section">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input 
          type="text" 
          placeholder="TÃ¬m kiáº¿m theo tÃªn, email hoáº·c username..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        />
      </div>

      <div class="filter-group">
        <select [(ngModel)]="selectedRole" (change)="onRoleFilterChange()" class="filter-select">
          <option value="all">Táº¥t cáº£ vai trÃ²</option>
          <option value="ADMIN">Admin</option>
          <option value="MANAGER">Manager</option>
          <option value="STAFF">Staff</option>
          <option value="USER">User</option>
        </select>

        <select [(ngModel)]="selectedStatus" (change)="onStatusFilterChange()" class="filter-select">
          <option value="all">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
          <option value="ACTIVE">Hoáº¡t Ä‘á»™ng</option>
          <option value="LOCKED">Bá»‹ khÃ³a</option>
        </select>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="results-summary">
      <p>Hiá»ƒn thá»‹ <strong>{{ filteredUsers.length }}</strong> / {{ totalUsers }} tÃ i khoáº£n</p>
    </div>

    <!-- Users Table -->
    <div class="table-wrapper">
      <table class="users-table">
        <thead>
          <tr>
            <th>TÃ i khoáº£n</th>
            <th>Há» tÃªn</th>
            <th>Email</th>
            <th>Sá»‘ Ä‘iá»‡n thoáº¡i</th>
            <th>Vai trÃ²</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>ÄÄƒng nháº­p cuá»‘i</th>
            <th class="actions-column">Thao tÃ¡c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers" class="user-row">
            <td>
              <div class="user-cell">
                <div class="user-avatar">{{ (user.username || 'U')[0].toUpperCase() }}</div>
                <span class="username">{{ user.username || 'N/A' }}</span>
              </div>
            </td>
            <td>{{ user.fullName || 'ChÆ°a cáº­p nháº­t' }}</td>
            <td>{{ user.email || 'N/A' }}</td>
            <td>{{ user.phone || 'N/A' }}</td>
            <td>
              <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
                {{ user.role }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="getStatusBadgeClass(user.status)">
                {{ user.status }}
              </span>
            </td>
            <td>{{ user.lastLogin || 'ChÆ°a Ä‘Äƒng nháº­p' }}</td>
            <td class="actions-column">
              <div class="action-buttons">
                <button 
                  class="btn-action btn-view" 
                  title="Chi tiáº¿t"
                  [routerLink]="['/admin/users', user.userId]">
                  ğŸ‘ï¸
                </button>
                <button 
                  class="btn-action btn-edit" 
                  title="Sá»­a"
                  [routerLink]="['/admin/users', user.userId, 'edit']">
                  âœï¸
                </button>
                <button 
                  *ngIf="user.status === 'ACTIVE'"
                  class="btn-action btn-lock" 
                  title="KhÃ³a tÃ i khoáº£n"
                  (click)="lockUser(user.userId, user.username)">
                  ğŸ”’
                </button>
                <button 
                  *ngIf="user.status === 'LOCKED'"
                  class="btn-action btn-unlock" 
                  title="Má»Ÿ khÃ³a"
                  (click)="unlockUser(user.userId, user.username)">
                  ğŸ”“
                </button>
                <button 
                  class="btn-action btn-delete" 
                  title="XÃ³a"
                  (click)="deleteUser(user.userId, user.username)">
                  ğŸ—‘ï¸
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredUsers.length === 0" class="empty-state">
        <p class="empty-icon">ğŸ”</p>
        <h3>KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng</h3>
        <p>Thá»­ thay Ä‘á»•i bá»™ lá»c hoáº·c tá»« khÃ³a tÃ¬m kiáº¿m</p>
      </div>
    </div>
  </div>
</div>