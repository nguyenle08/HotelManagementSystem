<div class="user-management">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Quáº£n lÃ½ tÃ i khoáº£n</h1>
      <p class="subtitle">Quáº£n lÃ½ ngÆ°á»i dÃ¹ng vÃ  phÃ¢n quyá»n há»‡ thá»‘ng</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="exportToCSV()">
        <span>ğŸ“¥</span> Xuáº¥t Excel
      </button>
      <button class="btn-primary" (click)="openCreateForm()">
        <span>â•</span> ThÃªm tÃ i khoáº£n
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-overview">
    <div class="stat-item">
      <div class="stat-icon total">ğŸ‘¥</div>
      <div class="stat-info">
        <span class="stat-label">Tá»•ng</span>
        <span class="stat-value">{{ totalUsers }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon active">âœ…</div>
      <div class="stat-info">
        <span class="stat-label">Hoáº¡t Ä‘á»™ng</span>
        <span class="stat-value">{{ activeUsers }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon locked">ğŸ”’</div>
      <div class="stat-info">
        <span class="stat-label">Bá»‹ khÃ³a</span>
        <span class="stat-value">{{ lockedUsers }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon admin">ğŸ›¡ï¸</div>
      <div class="stat-info">
        <span class="stat-label">Admin</span>
        <span class="stat-value">{{ adminCount }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon manager">ğŸ‘”</div>
      <div class="stat-info">
        <span class="stat-label">Quáº£n lÃ½</span>
        <span class="stat-value">{{ managerCount }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon staff">ğŸ‘¨â€ğŸ’¼</div>
      <div class="stat-info">
        <span class="stat-label">NhÃ¢n viÃªn</span>
        <span class="stat-value">{{ staffCount }}</span>
      </div>
    </div>

    <div class="stat-item">
      <div class="stat-icon user">ğŸ‘¤</div>
      <div class="stat-info">
        <span class="stat-label">KhÃ¡ch</span>
        <span class="stat-value">{{ userCount }}</span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Äang táº£i danh sÃ¡ch ngÆ°á»i dÃ¹ng...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="alert-error">
    <span>âš ï¸ {{ error }}</span>
    <button class="btn-retry" (click)="loadUsers()">Thá»­ láº¡i</button>
  </div>

  <!-- Create/Edit Form -->
  <div *ngIf="showForm && !loading && !error" class="form-section">
    <div class="form-card">
      <div class="form-header">
        <h2>{{ isEditMode ? 'Chá»‰nh sá»­a tÃ i khoáº£n' : 'ThÃªm tÃ i khoáº£n má»›i' }}</h2>
        <button class="btn-close" (click)="cancelForm()">âœ•</button>
      </div>

      <div *ngIf="formError" class="alert-error">
        <span>âš ï¸ {{ formError }}</span>
      </div>

      <form (ngSubmit)="onSubmitForm()">
        <div class="form-row">
          <div class="form-group">
            <label for="username">TÃªn Ä‘Äƒng nháº­p <span class="required">*</span></label>
            <input 
              type="text" 
              id="username"
              [(ngModel)]="formData.username"
              name="username"
              [disabled]="isEditMode"
              required
              placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
              class="form-input"
            />
            <small class="form-hint" *ngIf="!isEditMode">TÃªn Ä‘Äƒng nháº­p khÃ´ng thá»ƒ thay Ä‘á»•i sau khi táº¡o</small>
          </div>

          <div class="form-group">
            <label for="fullName">Há» vÃ  tÃªn <span class="required">*</span></label>
            <input 
              type="text" 
              id="fullName"
              [(ngModel)]="formData.fullName"
              name="fullName"
              required
              placeholder="Nguyá»…n VÄƒn A"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">Email</label>
            <input 
              type="email" 
              id="email"
              [(ngModel)]="formData.email"
              name="email"
              placeholder="email@example.com"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label for="phone">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
            <input 
              type="tel" 
              id="phone"
              [(ngModel)]="formData.phone"
              name="phone"
              placeholder="0901234567"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="role">Vai trÃ² <span class="required">*</span></label>
            <select 
              id="role"
              [(ngModel)]="formData.role"
              name="role"
              required
              class="form-select"
            >
              <option value="USER">KhÃ¡ch hÃ ng (USER)</option>
              <option value="STAFF">NhÃ¢n viÃªn (STAFF)</option>
              <option value="MANAGER">Quáº£n lÃ½ (MANAGER)</option>
              <option value="ADMIN">Quáº£n trá»‹ viÃªn (ADMIN)</option>
            </select>
          </div>

          <div class="form-group" *ngIf="!isEditMode">
            <label for="password">Máº­t kháº©u <span class="required">*</span></label>
            <input 
              type="password" 
              id="password"
              [(ngModel)]="formData.password"
              name="password"
              required
              placeholder="Nháº­p máº­t kháº©u"
              class="form-input"
            />
            <small class="form-hint">Tá»‘i thiá»ƒu 8 kÃ½ tá»±</small>
          </div>
        </div>

        <div class="form-group" *ngIf="isEditMode">
          <label>Tráº¡ng thÃ¡i hiá»‡n táº¡i</label>
          <div class="status-info">
            <span class="badge" [ngClass]="formData.status === 'ACTIVE' ? 'badge-active' : 'badge-locked'">
              {{ formData.status }}
            </span>
            <small class="form-hint">Sá»­ dá»¥ng nÃºt khÃ³a/má»Ÿ khÃ³a trong danh sÃ¡ch Ä‘á»ƒ thay Ä‘á»•i tráº¡ng thÃ¡i</small>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelForm()">
            Há»§y
          </button>
          <button type="submit" class="btn-primary" [disabled]="formLoading">
            <span *ngIf="formLoading" class="spinner-small"></span>
            {{ formLoading ? 'Äang xá»­ lÃ½...' : (isEditMode ? 'LÆ°u thay Ä‘á»•i' : 'Táº¡o tÃ i khoáº£n') }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- User List -->
  <div *ngIf="!loading && !error" class="user-list-container">
    <!-- Filters -->
    <div class="filters-section">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input 
          type="text" 
          placeholder="TÃ¬m kiáº¿m theo tÃªn, email hoáº·c username..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        />
      </div>

      <div class="filter-group">
        <select [(ngModel)]="selectedRole" (change)="onRoleFilterChange()" class="filter-select">
          <option value="all">Táº¥t cáº£ vai trÃ²</option>
          <option value="ADMIN">Admin</option>
          <option value="MANAGER">Manager</option>
          <option value="STAFF">Staff</option>
          <option value="USER">User</option>
        </select>

        <select [(ngModel)]="selectedStatus" (change)="onStatusFilterChange()" class="filter-select">
          <option value="all">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
          <option value="ACTIVE">Hoáº¡t Ä‘á»™ng</option>
          <option value="LOCKED">Bá»‹ khÃ³a</option>
        </select>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="results-summary">
      <p>Hiá»ƒn thá»‹ <strong>{{ filteredUsers.length }}</strong> / {{ totalUsers }} tÃ i khoáº£n</p>
    </div>

    <!-- Users Table -->
    <div class="table-wrapper">
      <table class="users-table">
        <thead>
          <tr>
            <th>TÃ i khoáº£n</th>
            <th>Há» tÃªn</th>
            <th>Email</th>
            <th>Sá»‘ Ä‘iá»‡n thoáº¡i</th>
            <th>Vai trÃ²</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>ÄÄƒng nháº­p cuá»‘i</th>
            <th class="actions-column">Thao tÃ¡c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers" class="user-row">
            <td>
              <div class="user-cell">
                <div class="user-avatar">{{ (user.username || 'U')[0].toUpperCase() }}</div>
                <span class="username">{{ user.username || 'N/A' }}</span>
              </div>
            </td>
            <td>{{ user.fullName || 'ChÆ°a cáº­p nháº­t' }}</td>
            <td>{{ user.email || 'N/A' }}</td>
            <td>{{ user.phone || 'N/A' }}</td>
            <td>
              <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
                {{ user.role }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="getStatusBadgeClass(user.status)">
                {{ user.status }}
              </span>
            </td>
            <td>{{ user.lastLogin || 'ChÆ°a Ä‘Äƒng nháº­p' }}</td>
            <td class="actions-column">
              <div class="action-buttons">
                <button 
                  class="btn-action btn-edit" 
                  title="Sá»­a"
                  (click)="openEditForm(user)">
                  âœï¸
                </button>
                <button 
                  *ngIf="user.status === 'ACTIVE'"
                  class="btn-action btn-lock" 
                  title="KhÃ³a tÃ i khoáº£n"
                  (click)="lockUser(user.userId, user.username)">
                  ğŸ”’
                </button>
                <button 
                  *ngIf="user.status === 'LOCKED'"
                  class="btn-action btn-unlock" 
                  title="Má»Ÿ khÃ³a"
                  (click)="unlockUser(user.userId, user.username)">
                  ğŸ”“
                </button>
                <button 
                  class="btn-action btn-delete" 
                  title="XÃ³a"
                  (click)="deleteUser(user.userId, user.username)">
                  ğŸ—‘ï¸
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredUsers.length === 0" class="empty-state">
        <p class="empty-icon">ğŸ”</p>
        <h3>KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng</h3>
        <p>Thá»­ thay Ä‘á»•i bá»™ lá»c hoáº·c tá»« khÃ³a tÃ¬m kiáº¿m</p>
      </div>
    </div>
  </div>
</div>